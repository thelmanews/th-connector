<!--
    @license
    Copyright (c) 2014 Thelma Project Authors. All rights reserved.
    This code may only be used under the MIT license found at http://thelmanews.github.io/LICENSE.txt
    The complete set of authors may be found at http://thelmanews.github.io//AUTHORS.txt
    The complete set of contributors may be found at http://thelmanews.github.io/CONTRIBUTORS.txt
-->
<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>th-connector Demo</title>

  <script src="../webcomponentsjs/webcomponents.js"></script>
  <link rel="import" href="th-connector.html">
  <link rel="import" href="../th-component-list/th-component-list.html">

  <link rel="import" href="../th-mapbox/th-mapbox.html">
  <link rel="import" href="../th-geocoder-firebase/th-geocoder-firebase.html">
  <link rel="import" href="../th-csv/th-csv.html">
  <link rel="import" href="../th-enigma/th-enigma.html">
  <link rel="import" href="../th-google-map/th-google-map.html">
  <link rel="import" href="../th-map-us/th-map-us.html">
  <link rel="import" href="../th-table-data/th-table-data.html">
  <link rel="import" href="../th-array-function/th-array-function.html">
  <link rel="import" href="../th-n-bar-chart/th-n-bar-chart.html">
  <link rel="import" href="../th-chart-data-filter/th-chart-data-filter.html">

</head>
<style type="text/css">
  h1 {
    margin: 10px;
    text-align: center;
    color: #5E5E5E;
    font-family: 'proxima-nova', sans-serif;
  }
  p {
    margin-left: 30px;
  }

  a, a:visited {
    color: #2fa3af;
    text-decoration: none;
  }
  div {
    background-color:#FEFEFE;
    padding: 5px;
  }

  body {
    font-family: 'proxima-nova', sans-serif;
    color: #5E5E5E;
    margin: 0;
  }

  html, body {
    width: 100%;
    height: 100%;
    font-size: 14px;
  }

  th-component-list {
    z-index: 100;
    position: absolute;
    right: 0px;
    top: 0px;
  }

</style>

<h1>Lenses Demo</h1>

<div>
  <p>
    <span>Sample data sets:</span>
    <br>
    <a href="http://en.wikipedia.org/wiki/List_of_Berlin_Wall_segments" target="_blank"> Data on Berlin Wall segments</a>
    <br>
    <a href="http://graphics.wsj.com/homeprice/" target="_blank"> WSJ Data on Home Prices</a>
  </p>
</div>

  <th-component-list></th-component-list>


  <th-connector animateOnInit="true">
       <th-table-data></th-table-data>
       
      <th-chart-data-filter style="min-width: 150px"></th-chart-data-filter>
      <th-array-function style="min-width: 150px;"></th-array-function>


      <!--
      <th-mapbox width="375" height="400" accessToken="pk.eyJ1IjoidGhlbG1hIiwiYSI6Ikd3RUlsTTQifQ.i6bojdSBKd6JHENLKsRjTA" mapId="examples.map-i87786ca" geolocation="false" showSwipeBar="false" animateOnInit="true" startingLat="38.8922" startingLng="-77.0348"></th-mapbox>
    -->
      <!--<th-n-bar-chart  chartHeight="400" chartWidth="375" animateOnInit="true"></th-n-bar-chart> --> 
  </th-connector>

</body>
<script>
    window.addEventListener('polymer-ready', function(e) {
      console.log('ready');

      var connector = document.querySelector('th-connector');

      var elementsJSON, connectionsJSON;

      setTimeout(function() {
        console.log('settimeout');

        console.log('before ',connector);
        var elements = connector._elements;
        var connections = connector._connections;

        console.log('elements', elements);

        function removeDomObjects(key, value) {
          //console.log(key,value);

          if(value instanceof HTMLElement) 
            return undefined;
          else
            return value;

        }

        var elementsJSON = JSON.stringify(elements, removeDomObjects);

        var connectionsJSON = JSON.stringify(connections , removeDomObjects);


        console.log('elements ',elementsJSON);
        console.log('connections', connectionsJSON);


        connector.remove();

          var newConnector = document.createElement('th-connector');

          console.log('~~~~~~ elements right after creation', newConnector._elements);          

        console.log('###################### RECREATE ######################################');


        setTimeout(function() {

          document.body.appendChild(newConnector);

          var elements = JSON.parse(elementsJSON);




          elements.forEach(function(el) {
            console.log(el);
            var domEl =  document.createElement(el.name);
            domEl.id = el.id;
            newConnector.appendChild(domEl);

          });

          setTimeout(function() {
                      newConnector._elements = elements;
          }, 1000)


       
          newConnector._connections = JSON.parse(connectionsJSON);
      //    
       //  console.log(newConnector._elements);
         console.log(newConnector._connections);


         

          newConnector._drawConnections()

          console.log('after ', newConnector);


        },1000);


      }, 5000);

    });
</script>
</html>
